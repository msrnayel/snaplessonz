<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Snaplessonz - الأحياء | Mohamed Naiel</title>
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Google Font -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;700;900&display=swap" rel="stylesheet">
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;700;900&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Tajawal', sans-serif;
            background: linear-gradient(135deg, #0f2027, #203a43, #2c5364);
            min-height: 100vh;
            padding: 20px;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 20px 60px rgba(0,0,0,0.4);
        }

        /* هيدر */
        .header {
            background: linear-gradient(135deg, #11998e, #38ef7d);
            color: white;
            padding: 50px 20px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .header-icon {
            font-size: 100px;
            position: absolute;
            left: 30px;
            top: 50%;
            transform: translateY(-50%);
            opacity: 0.15;
            animation: float 6s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(-50%) translateX(0); }
            50% { transform: translateY(-50%) translateX(20px); }
        }

        .header h1 {
            font-size: 3.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            text-transform: capitalize;
        }

        .header p {
            font-size: 1.4em;
            opacity: 0.95;
            font-weight: 300;
        }

        /* روابط التواصل */
        .social-links {
            background: #1a2a3a;
            padding: 20px;
            display: flex;
            justify-content: center;
            gap: 25px;
            flex-wrap: wrap;
        }

        .social-links a {
            color: white;
            font-size: 1em;
            padding: 12px 20px;
            border-radius: 50px;
            transition: all 0.3s;
            background: rgba(255,255,255,0.1);
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .social-links a:hover {
            background: rgba(255,255,255,0.2);
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }

        /* المحتوى */
        .main-content {
            padding: 30px;
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }

        .card {
            background: #fff;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            transition: all 0.3s;
            border: 2px solid transparent;
        }

        .card:hover {
            transform: translateY(-8px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.15);
            border-color: #38ef7d;
        }

        .card h2 {
            color: #11998e;
            margin-bottom: 20px;
            font-size: 1.8em;
            border-bottom: 3px solid #38ef7d;
            padding-bottom: 10px;
        }

        .card i {
            color: #11998e;
            margin-left: 10px;
        }

        /* البث المباشر */
        .live-section {
            background: linear-gradient(135deg, #ff6b6b, #feca57);
            color: white;
            padding: 40px;
            border-radius: 20px;
            text-align: center;
            margin: 30px 0;
            position: relative;
            overflow: hidden;
        }

        .live-icon {
            font-size: 80px;
            position: absolute;
            right: 30px;
            top: 50%;
            transform: translateY(-50%);
            opacity: 0.2;
        }

        .live-btn {
            background: white;
            color: #ff6b6b;
            padding: 15px 40px;
            border-radius: 50px;
            font-size: 1.2em;
            font-weight: bold;
            text-decoration: none;
            display: inline-block;
            margin-top: 20px;
            transition: all 0.3s;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            border: none;
            cursor: pointer;
        }

        .live-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 8px 25px rgba(0,0,0,0.3);
        }

        /* ملفات Drive */
        .drive-folders {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .folder-card {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            text-decoration: none;
        }

        .folder-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(102,126,234,0.4);
        }

        .folder-card i {
            font-size: 2.5em;
            margin-bottom: 10px;
            color: white;
        }

        /* قسم الفيديوهات */
        .video-section {
            margin: 20px 0;
        }

        .video-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .video-card {
            background: #f8f9fa;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            transition: all 0.3s;
        }

        .video-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
        }

        .video-thumbnail {
            width: 100%;
            height: 180px;
            position: relative;
            background: #000;
        }

        .video-thumbnail iframe {
            width: 100%;
            height: 100%;
            border: none;
        }

        .video-info {
            padding: 15px;
        }

        .video-title {
            font-weight: bold;
            color: #11998e;
            margin-bottom: 8px;
        }

        .video-description {
            font-size: 0.9em;
            color: #666;
            line-height: 1.4;
        }

        .delete-video {
            position: absolute;
            top: 5px;
            right: 5px;
            background: #f44336;
            color: white;
            border: none;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            cursor: pointer;
            display: none;
            z-index: 10;
        }

        .video-card:hover .delete-video {
            display: block;
        }

        /* نافذة Google Drive Modal */
        .drive-modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.8);
        }

        .drive-modal-content {
            background-color: white;
            margin: 5% auto;
            padding: 0;
            width: 90%;
            max-width: 900px;
            height: 80%;
            border-radius: 15px;
            overflow: hidden;
            position: relative;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }

        .drive-modal-header {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .drive-modal-body {
            height: calc(100% - 70px);
        }

        .drive-modal-body iframe {
            width: 100%;
            height: 100%;
            border: none;
        }

        .drive-close {
            color: white;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }

        .drive-close:hover {
            color: #f44336;
            transform: scale(1.1);
        }

        .drive-download-btn {
            background: #4caf50;
            color: white;
            padding: 8px 15px;
            border-radius: 5px;
            text-decoration: none;
            font-size: 0.9em;
            transition: all 0.3s;
        }

        .drive-download-btn:hover {
            background: #45a049;
            transform: translateY(-2px);
            box-shadow: 0 3px 10px rgba(0,0,0,0.2);
        }

        /* أزرار الإرسال */
        .submit-btn {
            background: #11998e;
            color: white;
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1em;
            transition: all 0.3s;
            margin: 5px;
        }

        .submit-btn:hover {
            background: #38ef7d;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(17,153,142,0.4);
        }

        .btn-danger {
            background: #f44336;
        }

        .btn-danger:hover {
            background: #ff6b6b;
        }

        .btn-success {
            background: #4caf50;
        }

        .btn-success:hover {
            background: #66bb6a;
        }

        /* لوحة المدير */
        .admin-panel {
            background: linear-gradient(135deg, #2c3e50, #3498db);
            color: white;
            padding: 20px;
            border-radius: 15px;
            margin: 20px 0;
            display: none;
        }

        .admin-panel.active {
            display: block;
        }

        .admin-login {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            text-align: center;
        }

        .admin-login input {
            width: 100%;
            max-width: 300px;
            padding: 12px;
            margin: 10px;
            border: 2px solid #ddd;
            border-radius: 8px;
        }

        /* إدارة الأسئلة */
        .question-list {
            background: white;
            color: #333;
            padding: 15px;
            border-radius: 10px;
            margin: 10px 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .question-actions {
            display: flex;
            gap: 10px;
        }

        .question-actions button {
            padding: 5px 10px;
            font-size: 0.8em;
        }

        /* رفع الملفات */
        .file-upload {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin: 10px 0;
            color: #333;
        }

        .file-upload input[type="file"] {
            margin: 10px 0;
        }

        /* نافذة التواصل المباشر */
        .contact-widget {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.2);
            z-index: 999;
            max-width: 250px;
        }

        .contact-widget h4 {
            color: #11998e;
            margin-bottom: 15px;
            font-size: 1.2em;
            border-bottom: 2px solid #38ef7d;
            padding-bottom: 8px;
        }

        .contact-widget a {
            display: block;
            padding: 10px;
            margin: 8px 0;
            background: #f5f7fa;
            border-radius: 8px;
            text-decoration: none;
            color: #333;
            transition: all 0.3s;
            text-align: center;
            font-weight: 500;
        }

        .contact-widget a:hover {
            background: #11998e;
            color: white;
            transform: translateX(-5px);
        }

        .contact-widget i {
            margin-left: 8px;
            color: #11998e;
        }

        .contact-widget a:hover i {
            color: white;
        }

        /* متجاوب */
        @media (max-width: 768px) {
            .header h1 {
                font-size: 2em;
            }
            .header-icon {
                display: none;
            }
            .social-links a {
                font-size: 0.9em;
                padding: 10px 15px;
            }
            .grid {
                grid-template-columns: 1fr;
            }
            .contact-widget {
                bottom: 10px;
                right: 10px;
                left: 10px;
                max-width: none;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- الهيدر -->
        <header class="header">
            <i class="fas fa-dna header-icon"></i>
            <h1>Snaplessonz - Mohamed Naiel</h1>
            <p>مادة الأحياء | المرحلة الثانوية</p>
        </header>

        <!-- روابط التواصل (تظهر للجميع) -->
        <div class="social-links">
            <a href="https://youtube.com/@snaplessonz" target="_blank" title="YouTube">
                <i class="fab fa-youtube"></i> YouTube
            </a>
            <a href="https://t.me/scifiction" target="_blank" title="Telegram">
                <i class="fab fa-telegram"></i> Telegram
            </a>
            <a href="https://whatsapp.com/channel/0029Vb6mkieCXC3SI70w9i0V" target="_blank" title="WhatsApp">
                <i class="fab fa-whatsapp"></i> WhatsApp
            </a>
            <a href="https://www.tiktok.com/@snaplessonz" target="_blank" title="TikTok">
                <i class="fab fa-tiktok"></i> TikTok
            </a>
            <a href="mailto:mednayel@gmail.com" target="_blank" title="البريد الإلكتروني">
                <i class="fas fa-envelope"></i> Email
            </a>
        </div>

        <!-- المحتوى -->
        <div class="main-content">
            
            <!-- البث المباشر -->
            <div class="live-section">
                <i class="fas fa-broadcast-tower live-icon"></i>
                <h2><i class="fas fa-video"></i> البث المباشر عبر Teams</h2>
                <p>حصص الشرح المباشرة كل يوم أحد & ثلاثاء & خميس الساعة 6 مساءً بتوقيت مصر</p>
                <button class="live-btn" onclick="window.open(getLiveLink(), '_blank')">
                    <i class="fas fa-video"></i> انضم للبث عبر Teams
                </button>
                <p style="margin-top: 15px; font-size: 0.9em;">⚠️ يتطلب تسجيل دخول Microsoft Teams</p>
            </div>

            <!-- قسم الفيديوهات -->
            <div class="card video-section">
                <h2><i class="fas fa-tv"></i> أحدث فيديوهات الأحياء</h2>
                <div class="video-grid" id="videosList">
                    <!-- سيتم ملؤها ديناميكياً -->
                </div>
            </div>

            <div class="grid">
                
                <!-- فيديوهات -->
                <div class="card">
                    <h2><i class="fas fa-play-circle"></i> فيديوهات الأحياء</h2>
                    <p>شروحات كاملة لكل الفصول | مسارات علمي & أدبي</p>
                    <div id="allVideosList" style="margin-top: 20px;">
                        <!-- سيتم ملؤها ديناميكياً -->
                    </div>
                    <div style="margin-top: 20px;">
                        <a href="https://youtube.com/@snaplessonz" target="_blank" style="background: #ff0000; color: white; padding: 10px 20px; border-radius: 8px; text-decoration: none; display: inline-block;">
                            <i class="fab fa-youtube"></i> زيارة القناة
                        </a>
                    </div>
                </div>

                <!-- ملفات Google Drive -->
                <div class="card">
                    <h2><i class="fas fa-folder-open"></i> ملفات Google Drive</h2>
                    <p>جميع الموارد منظمة ومحدثة تلقائياً</p>
                    <div class="drive-folders">
                        <div class="folder-card" onclick="openDriveModal('1bKcivS5WgOdOalZaO06v32DewAjaPVWm', 'ملخصات')">
                            <i class="fas fa-book"></i>
                            <div>ملخصات</div>
                        </div>
                        <div class="folder-card" onclick="openDriveModal('13G1-2g9hL73psJbMAv6_GGZFqG-zTN0L', 'اختبارات سابقة')">
                            <i class="fas fa-edit"></i>
                            <div>اختبارات سابقة</div>
                        </div>
                        <div class="folder-card" onclick="openDriveModal('1-TZ8Z8VMxT2aBR-xvnfVoZm3nwO_4KMH', 'كتب الوزارة')">
                            <i class="fas fa-graduation-cap"></i>
                            <div>كتب الوزارة</div>
                        </div>
                        <div class="folder-card" onclick="openDriveModal('1E1dgpvKBNsAQBOg2IzhIrZEunezeYPBY', 'مصادر المعلمين')">
                            <i class="fas fa-chalkboard-teacher"></i>
                            <div>مصادر المعلمين</div>
                        </div>
                        <div class="folder-card" onclick="openDriveModal('1gl-dOavBoceBJ5vbPwWYWYqV_Tjba3ak', 'نماذج إجابات')">
                            <i class="fas fa-check-double"></i>
                            <div>نماذج إجابات</div>
                        </div>
                    </div>
                    <p style="margin-top: 15px; font-size: 0.9em; color: #666;">
                        <i class="fas fa-info-circle"></i> اضغط على المجلد لعرض محتواه دون مغادرة الموقع
                    </p>
                </div>

                <!-- اختبارات سابقة -->
                <div class="card">
                    <h2><i class="fas fa-file-signature"></i> اختبارات سابقة</h2>
                    <ul style="list-style: none;" id="examsList">
                        <li style="background: #e8f5e9; padding: 12px; margin: 10px 0; border-radius: 8px;">
                            <i class="fas fa-file-pdf" style="color: #d32f2f;"></i>
                            <strong>امتحان منتصف الفصل:</strong> نوفمبر 2024 - مسار علمي
                            <a href="#" target="_blank" style="float: left; background: #4caf50; color: white; padding: 5px 15px; border-radius: 5px; text-decoration: none;">تحميل</a>
                            <button class="submit-btn btn-danger" style="float: left; margin-left: 5px; padding: 5px 10px; font-size: 0.8em;" onclick="removeFile(this)">
                                <i class="fas fa-trash"></i>
                            </button>
                        </li>
                        <li style="background: #e3f2fd; padding: 12px; margin: 10px 0; border-radius: 8px;">
                            <i class="fas fa-file-pdf" style="color: #d32f2f;"></i>
                            <strong>امتحان شهر أكتوبر:</strong> مسار أدبي
                            <a href="#" target="_blank" style="float: left; background: #2196f3; color: white; padding: 5px 15px; border-radius: 5px; text-decoration: none;">تحميل</a>
                            <button class="submit-btn btn-danger" style="float: left; margin-left: 5px; padding: 5px 10px; font-size: 0.8em;" onclick="removeFile(this)">
                                <i class="fas fa-trash"></i>
                            </button>
                        </li>
                        <li style="background: #fff3e0; padding: 12px; margin: 10px 0; border-radius: 8px;">
                            <i class="fas fa-file-pdf" style="color: #d32f2f;"></i>
                            <strong>نماذج إجابات:</strong> شاملة لكل الفصول
                            <a href="#" target="_blank" style="float: left; background: #ff9800; color: white; padding: 5px 15px; border-radius: 5px; text-decoration: none;">تحميل</a>
                            <button class="submit-btn btn-danger" style="float: left; margin-left: 5px; padding: 5px 10px; font-size: 0.8em;" onclick="removeFile(this)">
                                <i class="fas fa-trash"></i>
                            </button>
                        </li>
                    </ul>
                </div>

            </div>

        </div>

        <!-- لوحة تسجيل دخول المدير -->
        <div class="admin-login" id="adminLogin">
            <h3><i class="fas fa-user-shield"></i> منطقة المدير</h3>
            <p>إذا كنت المعلم، أدخل كلمة المرور للوصول لأدوات الإدارة</p>
            <input type="password" id="adminPassword" placeholder="أدخل كلمة المرور" />
            <br>
            <button class="submit-btn" onclick="loginAdmin()">
                <i class="fas fa-sign-in-alt"></i> دخول
            </button>
        </div>

        <!-- لوحة المدير -->
        <div class="admin-panel" id="adminPanel">
            <h3><i class="fas fa-tools"></i> أدوات المدير</h3>
            <p>مرحباً بك يا معلم! يمكنك هنا إدارة الفيديوهات ورفع الملفات.</p>
            <button class="submit-btn btn-danger" onclick="logoutAdmin()">
                <i class="fas fa-sign-out-alt"></i> تسجيل الخروج
            </button>
            
            <!-- تعديل رابط البث المباشر -->
            <div class="file-upload" style="margin-top: 20px;">
                <h4><i class="fas fa-link"></i> تعديل رابط البث المباشر</h4>
                <input type="text" id="liveLinkInput" placeholder="أدخل رابط Teams الجديد...">
                <button class="submit-btn btn-success" onclick="updateLiveLink()">
                    <i class="fas fa-save"></i> حفظ الرابط
                </button>
            </div>
            
            <!-- إدارة الفيديوهات -->
            <div class="video-management">
                <h4 style="margin: 20px 0 10px;"><i class="fas fa-video"></i> إدارة الفيديوهات</h4>
                <div class="file-upload">
                    <input type="text" id="videoTitle" placeholder="عنوان الفيديو (مثال: شرح الفصل الأول)">
                    <input type="text" id="videoUrl" placeholder="رابط الفيديو من YouTube">
                    <textarea id="videoDescription" placeholder="وصف الفيديو (اختياري)"></textarea>
                    <button class="submit-btn btn-success" onclick="addVideo()">
                        <i class="fas fa-plus"></i> إضافة الفيديو
                    </button>
                </div>
                <div id="videosListAdmin"></div>
            </div>

            <!-- رفع الملفات -->
            <div class="file-upload">
                <h4><i class="fas fa-cloud-upload-alt"></i> رفع ملفات جديدة</h4>
                <p style="font-size: 0.9em; color: #666;">ملاحظة: هذا يحفظ روابط الملفات فقط. ارفع الملفات أولاً إلى Google Drive ثم أضف الروابط هنا.</p>
                <input type="text" id="fileName" placeholder="اسم الملف (مثال: امتحان نوفمبر 2024)">
                <input type="text" id="fileLink" placeholder="رابط الملف من Google Drive">
                <select id="fileCategory">
                    <option value="exams">اختبارات سابقة</option>
                    <option value="summaries">ملخصات</option>
                    <option value="books">كتب الوزارة</option>
                    <option value="teacher">مصادر المعلمين</option>
                </select>
                <button class="submit-btn btn-success" onclick="addFile()">
                    <i class="fas fa-plus"></i> إضافة الملف
                </button>
            </div>
        </div>

        <!-- الفوتر -->
        <footer style="background: #1a2a3a; color: white; text-align: center; padding: 25px;">
            <p style="font-size: 1.2em; margin-bottom: 10px;">
                <i class="fas fa-dna"></i> Snaplessonz - Mohamed Naiel
            </p>
            <p>حقوق الطبع محفوظة لـ Snaplessonz - Mohamed Naiel</p>
            <p style="margin-top: 10px; font-size: 0.9em;">آخر تحديث: <span id="lastUpdate"></span></p>
        </footer>
    </div>

    <!-- نافذة Google Drive Modal -->
    <div id="driveModal" class="drive-modal">
        <div class="drive-modal-content">
            <div class="drive-modal-header">
                <h3 id="modalFolderName" style="margin: 0; font-size: 1.3em;"><i class="fas fa-folder-open"></i> عرض الملفات</h3>
                <div style="display: flex; align-items: center; gap: 15px;">
                    <a href="#" id="modalDownloadLink" target="_blank" class="drive-download-btn">
                        <i class="fas fa-download"></i> فتح في Drive
                    </a>
                    <span class="drive-close" onclick="closeDriveModal()">&times;</span>
                </div>
            </div>
            <div class="drive-modal-body">
                <iframe id="driveFrame" src=""></iframe>
            </div>
        </div>
    </div>

    <!-- نافذة التواصل المباشر -->
    <div class="contact-widget">
        <h4><i class="fas fa-comments"></i> تواصل معنا</h4>
        <a href="mailto:mednayel@gmail.com" target="_blank">
            <i class="fas fa-envelope"></i> البريد الإلكتروني
        </a>
        <a href="https://t.me/scifiction" target="_blank">
            <i class="fab fa-telegram"></i> تليجرام
        </a>
        <a href="https://whatsapp.com/channel/0029Vb6mkieCXC3SI70w9i0V" target="_blank">
            <i class="fab fa-whatsapp"></i> واتساب
        </a>
    </div>

    <!-- مكتبة SheetJS لتصدير Excel -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

    <script>
        // ==================== إعدادات المدير ====================
        const ADMIN_PASSWORD = "@Mantis1982";
        
        // متغيرات عامة
        let isAdmin = localStorage.getItem('isAdmin') === 'true';
        let studentName = '';
        let quizResultData = null;
        
        // ==================== نسخة المدير vs الجمهور ====================
        function checkAdminStatus() {
            if (isAdmin) {
                document.getElementById('adminLogin').style.display = 'none';
                document.getElementById('adminPanel').classList.add('active');
                document.querySelectorAll('.question-actions').forEach(el => el.style.display = 'flex');
                document.querySelectorAll('.btn-danger').forEach(el => {
                    if (el.innerHTML.includes('fa-trash')) {
                        el.style.display = 'inline-block';
                    }
                });
            } else {
                document.getElementById('adminLogin').style.display = 'block';
                document.getElementById('adminPanel').classList.remove('active');
                document.querySelectorAll('.question-actions').forEach(el => el.style.display = 'none');
                document.querySelectorAll('.btn-danger').forEach(el => {
                    if (el.innerHTML.includes('fa-trash')) {
                        el.style.display = 'none';
                    }
                });
            }
        }

        // تسجيل دخول المدير
        function loginAdmin() {
            const password = document.getElementById('adminPassword').value;
            if (password === ADMIN_PASSWORD) {
                isAdmin = true;
                localStorage.setItem('isAdmin', 'true');
                checkAdminStatus();
                loadVideosList();
                // تحميل رابط البث المباشر المحفوظ
                const savedLink = localStorage.getItem('teamsLink');
                if (savedLink) {
                    document.getElementById('liveLinkInput').value = savedLink;
                }
                alert('تم تسجيل الدخول بنجاح!');
            } else {
                alert('كلمة المرور غير صحيحة!');
            }
        }

        // تسجيل خروج المدير
        function logoutAdmin() {
            isAdmin = false;
            localStorage.removeItem('isAdmin');
            checkAdminStatus();
            alert('تم تسجيل الخروج.');
        }

        // ==================== نافذة Google Drive Modal ====================
        function openDriveModal(folderId, folderName) {
            const modal = document.getElementById('driveModal');
            const frame = document.getElementById('driveFrame');
            const folderNameElement = document.getElementById('modalFolderName');
            const downloadLink = document.getElementById('modalDownloadLink');
            
            // رابط العرض المضمن لمجلد Google Drive
            const embedUrl = `https://drive.google.com/embeddedfolderview?id=${folderId}#list`;
            const directUrl = `https://drive.google.com/drive/folders/${folderId}`;
            
            frame.src = embedUrl;
            folderNameElement.innerHTML = `<i class="fas fa-folder-open"></i> ${folderName}`;
            downloadLink.href = directUrl;
            
            modal.style.display = 'block';
            document.body.style.overflow = 'hidden'; // منع التمرير في الخلفية
        }

        function closeDriveModal() {
            const modal = document.getElementById('driveModal');
            const frame = document.getElementById('driveFrame');
            
            modal.style.display = 'none';
            frame.src = ''; // مسح المحتوى لتحرير الموارد
            document.body.style.overflow = 'auto'; // إعادة التمرير
        }

        // إغلاق النافذة عند الضغط على الخلفية
        window.onclick = function(event) {
            const modal = document.getElementById('driveModal');
            if (event.target == modal) {
                closeDriveModal();
            }
        }

        // إغلاق النافذة بضغط ESC
        document.addEventListener('keydown', function(event) {
            if (event.key === 'Escape') {
                closeDriveModal();
            }
        });

        // ==================== إدارة الفيديوهات ====================
        let videosDB = JSON.parse(localStorage.getItem('videosDB')) || [];

        // إضافة فيديو جديد
        function addVideo() {
            if (!isAdmin) {
                alert('يجب تسجيل الدخول كمدير أولاً');
                return;
            }
            
            const title = document.getElementById('videoTitle').value.trim();
            const url = document.getElementById('videoUrl').value.trim();
            const description = document.getElementById('videoDescription').value.trim();
            
            if (!title || !url) {
                alert('الرجاء إدخال عنوان وبيانات الفيديو');
                return;
            }
            
            // استخراج معرف الفيديو من الرابط
            const videoId = extractVideoId(url);
            if (!videoId) {
                alert('رابط YouTube غير صالح! تأكد من أن الرابط يحتوي على معرف الفيديو');
                return;
            }
            
            videosDB.push({ title, videoId, description, date: new Date().toLocaleDateString('ar-EG') });
            localStorage.setItem('videosDB', JSON.stringify(videosDB));
            
            alert('تم إضافة الفيديو بنجاح!');
            
            // مسح الحقول
            document.getElementById('videoTitle').value = '';
            document.getElementById('videoUrl').value = '';
            document.getElementById('videoDescription').value = '';
            
            loadVideosList();
            loadAllVideosList();
        }

        // استخراج معرف الفيديو من رابط YouTube
        function extractVideoId(url) {
            // الأنماط المختلفة لروابط YouTube
            const patterns = [
                /(?:youtube\.com\/watch\?v=|youtu\.be\/|youtube\.com\/embed\/)([^&\n?#]+)/,
                /youtube\.com\/watch\?.*v=([^&\n?#]+)/
            ];
            
            for (let pattern of patterns) {
                const match = url.match(pattern);
                if (match && match[1]) {
                    return match[1];
                }
            }
            return null;
        }

        // حذف فيديو
        function deleteVideo(index) {
            if (!isAdmin || !confirm('هل أنت متأكد من حذف هذا الفيديو؟')) return;
            
            videosDB.splice(index, 1);
            localStorage.setItem('videosDB', JSON.stringify(videosDB));
            loadVideosList();
            loadAllVideosList();
            loadVideosListAdmin();
            alert('تم حذف الفيديو');
        }

        // تحميل أحدث 3 فيديوهات فقط (لقسم أحدث فيديوهات الأحياء)
        function loadVideosList() {
            const videosList = document.getElementById('videosList');
            
            if (!videosList) return;
            
            // أخذ آخر 3 فيديوهات فقط
            const latestVideos = videosDB.slice(-3);
            
            if (videosDB.length === 0) {
                videosList.innerHTML = '<p style="text-align: center; color: #666;">لم تتم إضافة فيديوهات بعد. تفقد لاحقاً!</p>';
                return;
            }
            
            if (latestVideos.length === 0) {
                videosList.innerHTML = '<p style="text-align: center; color: #666;">لم تتم إضافة فيديوهات بعد.</p>';
                return;
            }
            
            let html = '<div class="video-grid">';
            latestVideos.forEach((video) => {
                const videoIndex = videosDB.indexOf(video);
                html += `
                    <div class="video-card">
                        <div class="video-thumbnail">
                            <iframe src="https://www.youtube.com/embed/${video.videoId}" 
                                    allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
                                    allowfullscreen></iframe>
                            <button class="delete-video" onclick="deleteVideo(${videoIndex})" title="حذف الفيديو">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                        <div class="video-info">
                            <div class="video-title">${video.title}</div>
                            <div class="video-description">${video.description || 'لا يوجد وصف'}</div>
                        </div>
                    </div>
                `;
            });
            html += '</div>';
            
            videosList.innerHTML = html;
        }

        // تحميل قائمة الفيديوهات الكاملة (لقسم فيديوهات الأحياء القديم)
        function loadAllVideosList() {
            const allVideosList = document.getElementById('allVideosList');
            
            if (!allVideosList) return;
            
            if (videosDB.length === 0) {
                allVideosList.innerHTML = '<p style="text-align: center; color: #666;">لم تتم إضافة فيديوهات بعد.</p>';
                return;
            }
            
            let html = '<div class="video-grid">';
            videosDB.forEach((video, index) => {
                html += `
                    <div class="video-card">
                        <div class="video-thumbnail">
                            <iframe src="https://www.youtube.com/embed/${video.videoId}" 
                                    allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
                                    allowfullscreen></iframe>
                        </div>
                        <div class="video-info">
                            <div class="video-title">${video.title}</div>
                            <div class="video-description">${video.description || 'لا يوجد وصف'}</div>
                        </div>
                    </div>
                `;
            });
            html += '</div>';
            
            allVideosList.innerHTML = html;
        }

        // تحميل قائمة الفيديوهات للمدير
        function loadVideosListAdmin() {
            const videosListAdmin = document.getElementById('videosListAdmin');
            
            if (!videosListAdmin) return;
            
            if (videosDB.length === 0) {
                videosListAdmin.innerHTML = '<p style="text-align: center; color: #666;">لم تتم إضافة فيديوهات بعد.</p>';
                return;
            }
            
            let html = '';
            videosDB.forEach((video, index) => {
                html += `
                    <div class="question-list">
                        <div>
                            <strong>فيديو ${index + 1}:</strong> ${video.title}
                            <br><small style="color: #666;">التاريخ: ${video.date}</small>
                        </div>
                        <div class="question-actions">
                            <button class="submit-btn btn-danger" onclick="deleteVideo(${index})">
                                <i class="fas fa-trash"></i> حذف
                            </button>
                        </div>
                    </div>
                `;
            });
            
            videosListAdmin.innerHTML = html;
        }

        // ==================== إدارة الملفات ====================
        let filesDB = JSON.parse(localStorage.getItem('filesDB')) || [
            {name: "امتحان منتصف الفصل: نوفمبر 2024 - مسار علمي", link: "#", category: "exams"},
            {name: "امتحان شهر أكتوبر: مسار أدبي", link: "#", category: "exams"},
            {name: "نماذج إجابات: شاملة لكل الفصول", link: "#", category: "exams"}
        ];

        // إضافة ملف جديد
        function addFile() {
            if (!isAdmin) {
                alert('يجب تسجيل الدخول كمدير أولاً');
                return;
            }
            
            const name = document.getElementById('fileName').value;
            const link = document.getElementById('fileLink').value;
            const category = document.getElementById('fileCategory').value;
            
            if (!name || !link) {
                alert('الرجاء ملء جميع الحقول');
                return;
            }
            
            filesDB.push({name, link, category});
            localStorage.setItem('filesDB', JSON.stringify(filesDB));
            
            alert('تم إضافة الملف بنجاح!');
            document.getElementById('fileName').value = '';
            document.getElementById('fileLink').value = '';
            
            updateFilesList();
        }

        // حذف ملف
        function removeFile(button) {
            if (!isAdmin) {
                alert('يجب تسجيل الدخول كمدير');
                return;
            }
            
            if (confirm('هل أنت متأكد من حذف هذا الملف؟')) {
                const li = button.closest('li');
                li.remove();
            }
        }

        // تحديث قائمة الملفات
        function updateFilesList() {
            const examsList = document.getElementById('examsList');
        }

        // ==================== إدارة رابط البث المباشر ====================
        function getLiveLink() {
            // جلب الرابط المحفوظ أو استخدام الرابط الافتراضي
            return localStorage.getItem('teamsLink') || 'https://teams.microsoft.com/l/meetup-join/19%3ameeting_30631606';
        }

        function updateLiveLink() {
            if (!isAdmin) {
                alert('يجب تسجيل الدخول كمدير أولاً');
                return;
            }
            
            const newLink = document.getElementById('liveLinkInput').value.trim();
            if (!newLink) {
                alert('الرجاء إدخال رابط صحيح');
                return;
            }
            
            localStorage.setItem('teamsLink', newLink);
            alert('تم تحديث رابط البث المباشر بنجاح!');
        }

        // ==================== تهيئة الصفحة ====================
        window.onload = function() {
            document.getElementById('lastUpdate').textContent = new Date().toLocaleDateString('ar-EG', {weekday: 'long', year: 'numeric', month: 'long', day: 'numeric'});
            checkAdminStatus();
            loadVideosList();
            loadAllVideosList();
            
            // تحميل رابط البث المباشر المحفوظ
            const savedLink = localStorage.getItem('teamsLink');
            if (savedLink && document.getElementById('liveLinkInput')) {
                document.getElementById('liveLinkInput').value = savedLink;
            }
            
            if (isAdmin) {
                loadVideosListAdmin();
            }
        };
    </script>
</body>
</html>